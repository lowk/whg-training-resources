"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[8379],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>g});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=p(n),g=i,d=c["".concat(l,".").concat(g)]||c[g]||u[g]||r;return n?a.createElement(d,o(o({ref:t},m),{},{components:n})):a.createElement(d,o({ref:t},m))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3948:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=n(7462),i=(n(7294),n(3905));const r={sidebar_position:12},o="Scaling up for a real analysis",s={unversionedId:"programming/programming_with_gene_annotations/Scaling_up",id:"programming/programming_with_gene_annotations/Scaling_up",title:"Scaling up for a real analysis",description:"Up to table of contents",source:"@site/docs/programming/programming_with_gene_annotations/Scaling_up.md",sourceDirName:"programming/programming_with_gene_annotations",slug:"/programming/programming_with_gene_annotations/Scaling_up",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Scaling_up",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/edit/main/docs/programming/programming_with_gene_annotations/Scaling_up.md",tags:[],version:"current",sidebarPosition:12,frontMatter:{sidebar_position:12},sidebar:"tutorialSidebar",previous:{title:"How much of the genome is in genes?",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/How_much_of_the_genome_is_in_genes"},next:{title:"What next?",permalink:"/whg-training-resources/programming/programming_with_gene_annotations/Where_next"}},l={},p=[{value:"Reducing how much is stored",id:"reducing-how-much-is-stored",level:3},{value:"Not storing it in the first place.",id:"not-storing-it-in-the-first-place",level:3},{value:"A real example",id:"a-real-example",level:3},{value:"What next?",id:"what-next",level:2}],m={toc:p};function u(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,a.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"scaling-up-for-a-real-analysis"},"Scaling up for a real analysis"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/"},"Up to table of contents")),(0,i.kt)("p",null,"So far we've written some code and (if you've done what I did) looked at data from a few species.\nThis intriguing but it'd really be great to take a more systematic look across species."),(0,i.kt)("p",null,"For example - maybe you'd like to run it for ",(0,i.kt)("a",{parentName:"p",href:"http://ftp.ensembl.org/pub/current_gff3/"},"all ~300 species with data on Ensembl"),"?).\n(To figure out how you might download this data - see ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/bioinformatics/tips_and_tricks/recursive_ftp"},"here"),".)"),(0,i.kt)("p",null,"However if you were to do this right now, you would likely run into problems - not least because\nthe output file will grow very large."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Challenge")," Make your code ready to apply at scale - say, to hundreds of species."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"}," An aside on python packaging. ")," If all your code is currently in a single file (say ",(0,i.kt)("inlineCode",{parentName:"p"},"gff.py"),"),\nit will be getting quite large - and possibly unwieldy. If so, a good idea is to turn it into a\npython 'package'.  (A package is a glorified module which has been split across multiple files)."),(0,i.kt)("p",null,"This is pretty easy as follows:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"create a new directory ",(0,i.kt)("inlineCode",{parentName:"p"},"gff"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"copy the code in ",(0,i.kt)("inlineCode",{parentName:"p"},"gff.py")," into the new directory. This is a good time to split it up into pieces\nof related code. (For example, I split up the gff parsing code into a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"parse.py"),", the\ncode for reading sequence lengths into a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"sequences.py"),", the code for dealing with\ngenomic regions into ",(0,i.kt)("inlineCode",{parentName:"p"},"regions.py"),", and the code that computes summaries into ",(0,i.kt)("inlineCode",{parentName:"p"},"summary.py"),".)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"gff/__init__.py"),".  The contents of mine is:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"__all__ = [\n    'parse',\n    'sequences',\n    'summary',\n    'regions'\n]\n\nfrom .parse import *\nfrom .sequences import *\nfrom .summary import *\nfrom .regions import *\n")),(0,i.kt)("p",null,"Congratulations! You have now written a python package. "),(0,i.kt)("p",null,"If the above isn't clear, you can see my version of this in\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/whg-training/whg-training-resources/blob/main/docs/programming/programming_with_gene_annotations/solutions/part3/gff/"},"this folder"),"."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"With the ",(0,i.kt)("inlineCode",{parentName:"p"},"__init__.py")," written as above, the package can still be used in the same way as\nbefore (i.e. by writing ",(0,i.kt)("inlineCode",{parentName:"p"},"import gff"),"). So you should still be able to run your test;"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre"},"python3 ./test_gff.py\n")),(0,i.kt)("p",{parentName:"div"},"The key benefit of a package is that it lets you split code\nup into smaller files, which I find makes it easier to edit and add to. It also provides you a\nplace to put tests (add a ",(0,i.kt)("inlineCode",{parentName:"p"},"tests/")," folder), and allows you more control over how the code is\naccessed (by altering ",(0,i.kt)("inlineCode",{parentName:"p"},"__init__.py"),".)"))),(0,i.kt)("h3",{id:"reducing-how-much-is-stored"},"Reducing how much is stored"),(0,i.kt)("p",null,"The current code essentially reconstructs a database of the input data - storing all the records.\nIf you did this for 300 species it would rapidly get very large indeed. Of course - you might want\na reconstructed database, which is after all a useful thing. But for most purposes it is probably\nbetter if we can reduce the amount of storage used - and also the amount of computation that needs\nto be done."),(0,i.kt)("p",null,"What improvements can we make to this? Here are some thoughts."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Our analysis so far only using the genes, transcripts, exons and CDS records. There's no point\nstoring anything else.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Many of the identifiers have redundant stuff in - for example ",(0,i.kt)("inlineCode",{parentName:"p"},"gene:")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"transcript:")," prefixes.\nEditing the identifiers to remove these prefixes would save quite a bit of space.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The attributes column uses up a lot of space.  Maybe we can just storing attributes for the gene\nrecords?"))),(0,i.kt)("p",null,"The above suggests one way to go. Storing only the records we need - and removing most of the\nattributes columns - indeed reduces the size of the database (I found by about a third)."),(0,i.kt)("h3",{id:"not-storing-it-in-the-first-place"},"Not storing it in the first place."),(0,i.kt)("p",null,"Of course if we really want to save space, we would avoid storing all that data for transcripts,\nexons etc. at all. Why don't we run our analysis on the gene data as we load it, and then only\nstore the gene-leve summaries we have computed?"),(0,i.kt)("p",null,"You can see ",(0,i.kt)("a",{target:"_blank",href:n(2059).Z},"my quick attempt at that here"),". If you run it,\ninstead of the original ",(0,i.kt)("inlineCode",{parentName:"p"},"gff_data"),", you get:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("inlineCode",{parentName:"p"},"genes")," table which just lists the gene records, but with the number of transcripts and mean number of\nexons have been added as extra columns.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("inlineCode",{parentName:"p"},"sequences")," table that lists the sequences extracted from the file.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("inlineCode",{parentName:"p"},"gene_statistics")," table which lists our ",(0,i.kt)("a",{parentName:"p",href:"Counting_genes2.md"},"gene count statistics"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("inlineCode",{parentName:"p"},"coverage_statistics")," table which lists our ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/How_much_of_the_genome_is_in_genes"},"genome coverage statistics")))),(0,i.kt)("p",null,"Importantly (unless you specify an option) the code does not store all the transcripts, exons, or\ncoding sequence records, and consequently the output file is much smaller. But it still allows us\nto explore interesting genes."),(0,i.kt)("h3",{id:"a-real-example"},"A real example"),(0,i.kt)("p",null,"You can see the code I reached when using this to answer these questions\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/whg-training/whg-training-resources/blob/main/docs/programming/programming_with_gene_annotations/solutions/real_analysis/"},"in this folder"),".\nIt has a few changes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The module has been split into a package of files, as described above."),(0,i.kt)("li",{parentName:"ul"},"The program is called ",(0,i.kt)("inlineCode",{parentName:"li"},"summarise_genes.py")," instead of ",(0,i.kt)("inlineCode",{parentName:"li"},"gff_to_sqlite.py")),(0,i.kt)("li",{parentName:"ul"},"The program avoids storing stuff that isn't needed (as also described above).")),(0,i.kt)("p",null,"To make it easier to write I wrapped up much of our analysis code into a new ",(0,i.kt)("a",{parentName:"p",href:"https://docs.python.org/3/tutorial/classes.html"},"python\nclass")," called ",(0,i.kt)("inlineCode",{parentName:"p"},"UnpackedGFF"),". It holds the genes, transcripts, exons, CDS, and\nsequences, and knows how to call the functions to summarise them."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note.")," Encapsulating things into this class was useful, because we have several related data objects and the class keeps them\nall in one place, and makes sure they are used appropriately. However, this class is arguably not very well written! It fails on\nsome of the ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Introduction"},"original criteria")," and it would be very hard to test. So really this class should be improved."),(0,i.kt)("h2",{id:"what-next"},"What next?"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"./What_next.md"},"What next indeed")),(0,i.kt)("p",null,"The next page has some ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations/Visualisation"},"tips on visualisation"),"."))}u.isMDXComponent=!0},2059:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/files/summarise_gff3-f10558916724a39d56ebee116a862359.py"}}]);